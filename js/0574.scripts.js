"use strict";!function(){function a(){function a(){h.attr("transform","translate("+j.event.translate+")scale("+j.event.scale+")")}var b=j.behavior.zoom().center([m/2,n/2]).scaleExtent([.5,10]).on("zoom",a);d=j.select("body").append("svg").attr("width","100%").attr("height","100%").call(b).on("dblclick.zoom",null),g=d.append("rect").attr("id","backgroud").attr("width",m).attr("height",n),h=d.append("g").attr("id","system")}function b(){var a=k.defer(),b=window.location.origin+window.location.pathname+"data/tree.json";return j.json(b,function(b,c){return b?console.warn(b):(a.resolve(c),void 0)}),a.promise}function c(a){function b(a){var b;return"bastard"===a.styleNode||"chronological"===a.styleNode?b="white":"default"===a.styleNode||"sibling"===a.styleNode?b="black":("selected"===a.styleNode||"root"===a.styleNode)&&(b="red"),b}function c(a){var b;return("root"===a.styleNode||"selected"===a.styleNode)&&(b="red"),b}function k(a){var b;return"default"===a.styleNode||"bastard"===a.styleNode||"chronological"===a.styleNode?b=5:("selected"===a.styleNode||"sibling"===a.styleNode||"root"===a.styleNode)&&(b=20),b}function p(a){var b;return"root"===a.styleNode?b="titles root-title":"selected"===a.styleNode?b="titles select-title":"sibling"===a.styleNode&&(b="titles sibling-title"),b}function q(a){var b=5;return"root"===a.styleNode?b=20:("selected"===a.styleNode||"siblings"===a.styleNode)&&(b=10),b}function r(a){var b,c='<div class="titles">{{text}}</div>';return b="chronological"===a.type?a.chronologicalName:"bastard"===a.type?a.bastardName:a.name,c.replace(/{{text}}/,b)}function s(a){var b=[];return b[0]=m/2-a.x,b[1]=n/2-a.y,b}function t(a){var d,f;"undefined"==typeof a&&(a=e.selectAll(".node")),d=a.select("circle"),f=a.select(".titles"),d.attr("r",function(a){return k(a)}).style("fill",b).style("stroke",c),f.attr("class",function(a){return p(a)})}function u(){function a(a){function c(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2),Math.pow(a[1]-b[1],2))}var d,e,f=5,g=null;a.on("mousedown",function(){d=j.mouse(document.body),e=+new Date}),a.on("mouseup",function(){c(d,j.mouse(document.body))>f||(g?(window.clearTimeout(g),g=null,b.dblclick(j.event)):g=window.setTimeout(function(a){return function(){b.click(a),g=null}}(j.event),300))})}var b=j.dispatch("click","dblclick");return j.rebind(a,b,"on")}function v(a){var b,c=[];b=j.select(a.toElement).data()[0],console.log(b),c=s(b),i.setFocus(b.id,c),window.location=window.location.origin+window.location.pathname+"#/"+b.guid}function w(a){var b;if(b=j.select(a.toElement).data()[0],0!==b.depth){for(;"chronological"===b.type;)b=b.parent;window.location=window.location.origin+window.location.pathname+"pages/"+b.guid}}var x=j.scale.linear().domain([0,1]).range([5,20]),y=u();y.on("click",v).on("dblclick",w);var z=j.layout.tree().size([m,n]).separation(function(a,b){return a.parent===b.parent?1:2}),A=z.nodes(a),B=z.links(A);A.forEach(function(a,b){a.id=b,a.name=a.name.replace(/.{1,20} /g,"$&\n"),a.active=0,a.selected=!1,a.styleNode=a.type}),e=h.append("g").attr("id","nodes").style("stroke","black").style("stroke-width","1").style("fill","none"),f=d.append("svg:circle").attr("class","center").style("fill","red").attr("r",0).attr("cx",function(){return m/2}).attr("cy",function(){return n/2}),e.selectAll(".link").data(B).enter().append("path").attr("class","link").attr("d",function(a){function b(a){return a.x}function c(a){return a.y}return"M"+b(a.source)+","+c(a.source)+"L"+b(a.target)+","+c(a.target)}).style("stroke-width",3);var C=e.selectAll(".node").data(A).enter().append("g").attr("id",function(a,b){return"n"+b}).attr("guid",function(a){return a.guid}).attr("class","node").attr("transform",function(a){return"translate("+a.x+","+a.y+")"});return C.append("foreignObject").attr("x",-20).attr("y",10).attr("width",40).attr("height",40).append("xhtml:body").attr("class","area").html(r),C.append("circle").attr("id",function(a,b){return"n"+b}).attr("r",function(a){return x(a.selected)}).style("fill",b).style("stroke",function(a){return a.active?"red":"black"}).call(y),C.append("svg:text").attr("class","id").style("font-family","Verdana").attr("font-size",q).attr("dy",2).attr("dx",0).attr("text-anchor","middle").text(function(a){return a.chronologicalId}).call(y),{setBackgroud:function(){g.style("fill","white")},setCenter:function(){f.attr("r",5)},setRootStyle:function(){var a=j.select("#n0");a.data().pop().styleNode="root",t()},selectNode:function(a){var b=a.data()[0];a.data().forEach(function(a){a.selected=!0,a.styleNode="selected"}),l.each(l.where(A,{depth:b.depth}),function(a,b){A[b].styleNode="sibling"}),t()},setFocus:function(a,b){h.transition().duration(o).attr("transform","translate("+b.toString()+")")}}}{var d,e,f,g,h,i,j=window.d3,k=window.Q,l=window._,m=960,n=500,o=250;j.scale.linear().domain([0,1]).range([2.5,5]),j.scale.linear().domain([0,1,3]).range(["black","red","white"])}a(),b().then(function(a){i=new c(a),i.setBackgroud(),i.setCenter()})}();