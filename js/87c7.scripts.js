"use strict";!function(){function a(a,b){a=a?a:1e4,b=b?b:1e4,d=e.select("body").append("svg").attr("width",a).attr("height",b).append("g")}function b(){function a(a){var b=f.defer();return e.json(a,function(a,c){return a?console.warn(a):(b.resolve(c),void 0)}),b.promise}var b=f.defer(),c=window.location.href+"data/TorahBasch_16112013.json";return a(c).then(function(a){function c(){function b(a){function b(a){var c=[],e=[],f={};return void 0===a.children&&(a.children=[]),a.fill="red",f={dir:1,childs:g.where(i,{idA:a.guid,dir:"1"})},e.push(f),f={dir:2,childs:g.where(i,{idB:a.guid,dir:"2"})},e.push(f),g.each(e,function(e){c=e.childs,g.each(c,function(c){c.node={},c.node.children=[],1===e.dir?c.node=d[c.idB]:2===e.dir&&(c.node=d[c.idA]),c.node.children=b(c.node),a.children.push(c.node)})}),a.children}var e,f;return e=d[a],f=g.indexOf(h,d[a]),e.children=[],console.log(e),e.children=b(e),c={fill:e.guid===j?"green":"red"},e=g.extend(e,c)}var c={},d=[],e={};return h=a.BrainData.Thoughts.Thought,i=a.BrainData.Links.Link,g.each(h,function(a,b){h[b]=g.pick(a,"guid","name")}),g.each(i,function(a,b){i[b]=g.pick(a,"guid","idA","idB","dir","linkTypeID","isBackward")}),d=g.indexBy(h,"guid"),h=g.without(h,d[j]),h.unshift(d[j]),h[0].root=!0,d=g.indexBy(h,"guid"),e=b(j)}var d;j=a.BrainData.Source.homeThoughtGuid,d=c(),b.resolve(d)}),b.promise}function c(a){function b(){var b,c,f=3e3,g=3e3;a.x0=f/2,a.y0=0,b=e.layout.tree().size([f,g]);var h=b.nodes(a);c=b.links(h),h.forEach(function(a){a.y=0===a.depth?50:260*a.depth}),c.forEach(function(a){console.log(a.source.y,a.target.y,10*a.source.depth,a.target.depth)}),console.log(a),console.log(h),console.log(c);var i=d.selectAll("g.node").data(h).enter().append("svg:g").attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),j=d.selectAll("g.link").data(c).enter();j.append("svg:line").style("stroke","black").attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),i.append("svg:circle").attr("r",40).style("fill",function(a){return a.fill}),i.append("svg:circle").attr("r",35).style("fill","#FFF"),i.append("svg:text").attr("dx",function(a){return a.children?-8:8}).attr("dy",3).attr("text-anchor",function(a){return a.children?"end":"start"}).text(function(a){return a.name})}b()}var d,e=window.d3,f=window.Q,g=window._,h=[],i=[],j="";a(),b().then(function(a){c(a)})}();