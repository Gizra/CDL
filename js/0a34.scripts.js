"use strict";!function(){function a(){function a(){h.attr("transform","translate("+j.event.translate+")scale("+j.event.scale+")")}o=960,m=o,n=o;var b=j.behavior.zoom().center([m/2,n/2]).scaleExtent([.5,10]).on("zoom",a);d=j.select("body").append("svg").attr("width","100%").attr("height","100%").call(b).on("dblclick.zoom",null),g=d.append("rect").attr("id","backgroud").attr("width",m).attr("height",n),h=d.append("g").attr("id","system")}function b(){var a=k.defer(),b=window.location.href+"data/tree.json";return j.json(b,function(b,c){return b?console.warn(b):(a.resolve(c),void 0)}),a.promise}function c(a){function b(a){var b;return"bastard"===a.styleNode||"chronological"===a.styleNode||"root"===a.styleNode?b="white":"default"===a.styleNode||"sibling"===a.styleNode?b="black":"selected"===a.styleNode&&(b="red"),b}function c(a){var b;return("root"===a.styleNode||"selected"===a.styleNode)&&(b="red"),b}function i(a){var b;return"default"===a.styleNode||"bastard"===a.styleNode||"chronological"===a.styleNode?b=5:"root"===a.styleNode?b=40:("selected"===a.styleNode||"sibling"===a.styleNode)&&(b=20),b}function k(a){var b;return"root"===a.styleNode?b="red":("selected"===a.styleNode||"sibling"===a.styleNode)&&(b="white"),b}function q(a){var b=5;return"root"===a.styleNode?b=20:("selected"===a.styleNode||"siblings"===a.styleNode)&&(b=10),b}function r(a){return"chronological"===a.type?a.chronologicalName:"bastard"===a.type?a.bastardName:a.name}function s(a){var d,f;"undefined"==typeof a&&(a=e.selectAll(".node")),d=a.select("circle"),f=a.select("text"),d.attr("r",function(a){return i(a)}).style("fill",b).style("stroke",c),f.attr("font-size",function(a){return p(a.selected)}).style("fill",k).attr("font-size",q)}function t(){function a(a){function c(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2),Math.pow(a[1]-b[1],2))}var d,e,f=5,g=null;a.on("mousedown",function(){d=j.mouse(document.body),e=+new Date}),a.on("mouseup",function(){c(d,j.mouse(document.body))>f||(g?(window.clearTimeout(g),g=null,b.dblclick(j.event)):g=window.setTimeout(function(a){return function(){b.click(a),g=null}}(j.event),300))})}var b=j.dispatch("click","dblclick");return j.rebind(a,b,"on")}function u(){}function v(a){var b;if(b=j.select(a.toElement).data()[0],0!==b.depth){for(;"chronological"===b.type;)b=b.parent;window.location=window.location.href+"pages/"+b.guid}}var w=j.scale.linear().domain([0,1]).range([5,20]),x=t();x.on("click",u).on("dblclick",v);var y=j.layout.tree().size([360,1.35*o]).separation(function(a,b){return(a.parent===b.parent?.7:1)/a.depth}),z=y.nodes(a),A=y.links(z);z.forEach(function(a){a.name=a.name.replace(/.{1,20} /g,"$&\n"),a.active=0,a.selected=!1,a.styleNode=a.type}),h.append("g").attr("id","orbits").selectAll("circle").data(j.range(10,1.35*m,75)).enter().append("circle").attr("class","orbit").attr("cx",m/2).attr("cy",n/2).attr("r",function(a){return a}).style("fill","none").style("stroke","black"),e=h.append("g").attr("id","nodes").style("stroke","black").style("stroke-width","1").style("fill","white").attr("transform","translate("+o/2+","+o/2+")"),f=d.append("svg:circle").attr("class","center").style("fill","red").attr("r",0).attr("cx",function(){return m/2}).attr("cy",function(){return n/2}),e.selectAll(".link").data(A).enter().append("path").attr("class","link").attr("d",function(a){function b(a){return a.y*Math.cos((a.x-90)/180*Math.PI)}function c(a){return a.y*Math.sin((a.x-90)/180*Math.PI)}return"M"+b(a.source)+","+c(a.source)+"L"+b(a.target)+","+c(a.target)}).style("stroke-width",2);var B=e.selectAll(".node").data(z).enter().append("g").attr("id",function(a,b){return"n"+b}).attr("class","node").attr("transform",function(a){return"rotate("+(a.x-90)+")translate("+a.y+")"});return B.append("circle").attr("id",function(a,b){return"n"+b}).attr("r",function(a){return w(a.selected)}).style("fill",b).style("stroke",function(a){return a.active?"red":"black"}).call(x),B.append("text").attr("class","name").style("font-family","Verdana").style("stroke-width","0").attr("text-anchor","middle").attr("transform",function(a){return"rotate("+(-a.x+90)+")"}).text(r).call(x),B.append("svg:text").attr("class","id").style("font-family","Verdana").attr("font-size",q).attr("dy",2).attr("dx",0).attr("text-anchor","middle").attr("transform",function(a){return"rotate("+(-a.x+90)+")"}).text(function(a){return a.chronologicalId}).call(x),{setBackgroud:function(){g.style("fill","white")},setCenter:function(){f.attr("r",10)},clearText:function(a){a.style("fill","none")},setRootStyle:function(){var a=j.select("#n0");a.data().pop().styleNode="root",z[0].styleNode="root",s()},selectNode:function(a){var b=a.data()[0];a.data().forEach(function(a){a.selected=!0,a.styleNode="selected"}),l.each(l.where(z,{depth:b.depth}),function(a,b){z[b].styleNode="sibling"}),s()}}}{var d,e,f,g,h,i,j=window.d3,k=window.Q,l=window._,m=960,n=500,o=960,p=(j.scale.linear().domain([0,30]).range([0,m]),j.scale.linear().domain([0,1]).range(["black","red","white"]),j.scale.linear().domain([0,1]).range([2.5,5]));j.scale.linear().domain([0,1,3]).range(["black","red","white"])}a(),b().then(function(a){i=new c(a),i.setBackgroud(),i.clearText(j.select("#nodes").selectAll(".node").select("text")),i.setRootStyle(),i.selectNode(j.select("#n39"))})}();